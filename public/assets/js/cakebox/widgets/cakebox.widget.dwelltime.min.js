var cakeboxWidgetDwelltime=function(e,t){return cakeboxWidget.apply(this,arguments),this.obj=e,this.default_chart_type="line",this.supported_chart_types={bar:"Bar Chart",line:"Line Chart"},this.dwelltime_data=[],this.data_api_url="/api/widget/dwelltime",this.branch_api_url="/api/zone2",this.date_filter_url="/api/datefilters",this.settings=$.extend(!0,this.defaults,t),this.init(),this};cakeboxWidgetDwelltime.prototype=Object.create(cakeboxWidget.prototype),cakeboxWidgetDwelltime.prototype.createUI=function(){var e=this,t=$("<div />").attr("id","widget_"+e.settings.id).addClass("cakebox-widget").appendTo(this.obj),a=$("<h3 />").addClass("handle").appendTo(t);""!==e.settings.chartTitle&&a.text(e.settings.chartTitle).appendTo(a);var i=$("<div />").addClass("panel").addClass("panel-flat").appendTo(t),o=$("<div />").addClass("heading-elements").appendTo(a),l=$("<ul />").addClass("icons-list").appendTo(o);if(Object.keys(e.supported_chart_types).length>1){var s=$("<li />").appendTo(l),n=$("<select />").attr("id",e.settings.id+"_charttype").appendTo(s);$.each(e.supported_chart_types,function(t,a){var i=$("<option />").attr("value",t).text(a).appendTo(n);t===e.settings.chartType&&i.attr("selected","selected")}),n.change(function(){e.settings.chartType=$(this).val(),e.validChartType(),e.setChartOption()})}if(null!==e.settings.btn_reload&&($("<li />").html('<a id="'+e.settings.btn_reload.id+'" data-action="reload" title="'+e.settings.btn_reload.title+'"></a>').appendTo(l),$("#"+e.settings.btn_reload.id).click(function(t){t.preventDefault(),e.demo===!1&&e.loadData()})),null!==e.settings.btn_remove&&($("<li />").html('<a id="'+e.settings.btn_remove.id+'" data-action="close" title="'+e.settings.btn_remove.title+'" rel="'+e.settings.id+'"></a>').appendTo(l),$("#"+e.settings.btn_remove.id).click(function(t){t.preventDefault(),null!==e.settings.btn_remove.confirm&&""!==e.settings.btn_remove.confirm?confirm(e.settings.btn_remove.confirm)&&e.removeMe():e.removeMe()})),null!==e.settings.filters&&e.settings.filters.enabled===!0){var d=$("<div />").addClass("panel-heading").appendTo(i),r=$("<div />").addClass("row").appendTo(d),p=$("<div />").addClass("col-md-12").appendTo(r),c=$("<div />").addClass("row").addClass("btn_top").appendTo(p),h=$("<div />").addClass("col-md-3").appendTo(c),m=$("<select />").attr("id",e.settings.filters.branch.id).addClass("form-control").appendTo(h);$("<option />").attr("value","").text("CHOOSE AREA").appendTo(m),m.change(function(){var t=$(this).val();$("#"+e.settings.filters.compare.id+" option").css("display","inherit"),""!==t&&$("#"+e.settings.filters.compare.id+" #vcp_"+t).css("display","none");var a=$("#"+e.settings.filters.compare.id).val();t===a&&$("#"+e.settings.filters.compare.id).val(""),e.demo===!1&&e.loadData()});var g=$("<div />").addClass("col-md-3").appendTo(c),f=$("<select />").attr("id",e.settings.filters.compare.id).addClass("form-control").appendTo(g);$("<option />").attr("value","").text("COMPARE").appendTo(f),$("<option />").attr("value","average").text("AVERAGE").appendTo(f),f.change(function(){e.demo===!1&&e.loadData()});var v=$("<div />").addClass("col-md-3").appendTo(c),u=$("<select />").attr("id",e.settings.filters.type.id).addClass("form-control").appendTo(v);$.each(e.settings.filters.type.items,function(t,a){var i=$("<option />").attr("value",t).text(a).appendTo(u);e.settings.filters.type.value===a&&i.attr("selected","selected")}),u.change(function(){e.updateChartData()});var _=$("<div />").addClass("col-md-3").appendTo(c);$("<select />").attr("id",e.settings.filters.date.id).addClass("form-control").appendTo(_),e.loadFilters(),e.loadBranches()}var b=$("<div />").addClass("panel-body").appendTo(i),x=$("<div />").addClass("chart-container").appendTo(b);$("<div />").addClass("chart-loading").attr("id",e.settings.id+"_loading").html('<div><i class="icon-spinner2 spinner"></i> '+e.settings.loading+"</div>").appendTo(x);var T=$("<div />").addClass("chart").attr("id",e.settings.id).appendTo(x);e.settings.fixedHeight===!0&&T.addClass("has-fixed-height")},cakeboxWidgetDwelltime.prototype.loadData=function(e){var t=this,a=this.data_api_url,i=!0,o=this.getQueryParameter(e);("undefined"==typeof o.area||"undefined"!=typeof o.area&&(""===o.area||isNaN(o.area)))&&(i=!1),i&&($("#"+this.settings.id+"_loading").show("fast"),$.post(a,o,function(e){t.dwelltime_data=e.data,t.updateChartData()}))},cakeboxWidgetDwelltime.prototype.setDataSeriesFormat=function(){var e=this,t=[],a=[],i=!1;if(e.demo?i=cakeboxChart.getDemoXAxis(e.settings.chartType):"undefined"!=typeof e.dwelltime_data.xAxis&&e.dwelltime_data.xAxis.length>0&&(i=cakeboxChart.getXAxis(e.settings.chartType,{data:e.dwelltime_data.xAxis})),i!==!1&&"undefined"!=typeof e.chart_options.xAxis&&(e.chart_options.xAxis=[],e.chart_options.xAxis=i),e.demo)t=cakeboxChart.getDemoSerie(e.settings.chartType);else{var o,l,s,n=e.dwelltime_data.series,d=$("#"+e.settings.filters.type.id).val();"undefined"==typeof d&&(d="all"),$.each(n,function(i,n){if("all"===d||"new"===d)if("undefined"!=typeof n.data["new"]&&n.data["new"].length>0){o=0===i?e.settings.chart["new"].color:e.settings.chart["new"].compare.color,l=0===i?e.settings.chart["new"].label.color:e.settings.chart["new"].compare.label.color,s=n.name+" - New";var r=cakeboxChart.getSerieFormat(e.settings.chartType,n.data["new"],{name:s,color:o,txt_color:l});t.push(r),a.push(s)}else console.log("dwelltime new data not existed - "+i);if("all"===d||"repeat"===d)if("undefined"!=typeof n.data.repeat&&n.data.repeat.length>0){o=0===i?e.settings.chart.repeat.color:e.settings.chart.repeat.compare.color,l=0===i?e.settings.chart.repeat.label.color:e.settings.chart.repeat.compare.label.color,s=n.name+" - Repeat";var r=cakeboxChart.getSerieFormat(e.settings.chartType,n.data.repeat,{name:s,color:o,txt_color:l});t.push(r),a.push(s)}else console.log("dwelltime repeat data not existed - "+i);if("all"===d||"total"===d)if("undefined"!=typeof n.data.total&&n.data.total.length>0){o=0===i?e.settings.chart.total.color:e.settings.chart.total.compare.color,l=0===i?e.settings.chart.total.label.color:e.settings.chart.total.compare.label.color,s=n.name+" - Total";var r=cakeboxChart.getSerieFormat(e.settings.chartType,n.data.total,{name:s,color:o,txt_color:l});t.push(r),a.push(s)}else console.log("dwelltime total data not existed - "+i)}),"undefined"!=typeof e.chart_options.legend&&"undefined"!=typeof e.chart_options.legend.data&&(e.chart_options.legend.data=[],e.chart_options.legend.data=e.clone(a))}e.chart_options.series=t},function(e){"use strict";e.fn.cakeboxDwelltime=function(t){if(this.length>1)return this.each(function(){e(this).cakeboxDwelltime(t)}),this;var a={id:"dwelltime",chartType:"line",defaultChartType:"line",chart:{"new":{name:"New",color:"",label:{color:"#000"},compare:{name:"New Compare",color:"",label:{color:""}}},repeat:{name:"Repeat",color:"",label:{color:"#000"},compare:{name:"Repeat Compare",color:"",label:{color:""}}},total:{name:"Total",color:"",label:{color:"#000"},compare:{name:"Total Compare",color:"",label:{color:""}}}},chartTitle:"DWELL TIME",fixedHeight:!0,xAxis:{name:"Time"},yAxis:{format:"{value} minutes",line:{color:"#666"}},grid:{x:100,x2:20,y:35,y2:25},btn_reload:{id:"dwelltime_reload",title:"Reload data"},btn_remove:{id:"dwelltime_remove",title:"Remove this chart",confirm:"Please confirm to remove this chart"},filters:{enabled:!0,branch:{id:"dwelltime_branch",value:5},compare:{id:"dwelltime_compare",value:""},date:{id:"dwelltime_date",value:"this_month"},type:{id:"dwelltime_type",items:{all:"ALL TYPES","new":"NEW",repeat:"REPEAT",total:"TOTAL"},value:""}},loading:"Loading"},i=e.extend(!0,a,t),o=new cakeboxWidgetDwelltime(this,i);return this.refreshChart=function(){o.refreshChart()},this.removeChart=function(){o.removeChart()},this}}(jQuery);