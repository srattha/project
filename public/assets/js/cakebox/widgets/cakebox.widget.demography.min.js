var cakeboxWidgetDemography=function(t,e){return cakeboxWidget.apply(this,arguments),this.obj=t,this.default_chart_type="bar",this.supported_chart_types={bar:"Bar Chart",line_area:"Line Chart"},this.demography_data={series:[[{name:"male",data:[0,1,0,0,0,0]},{name:"female",data:[0,0,0,0,0,0]}],[{name:"compare male",data:[]},{name:"compare female",data:[]}]],xAxis:[]},this.visitor_data=[],this.current_type="",this.data_api_url="/api/widget/demography",this.branch_api_url="/api/zone2",this.date_filter_url="/api/datefilters",this.chart_options={},this.chart_options_man={},this.chart_options_woman={},this.settings=$.extend(!0,this.defaults,e),this.init(),this};cakeboxWidgetDemography.prototype=Object.create(cakeboxWidget.prototype),cakeboxWidgetDemography.prototype.createUI=function(){var t=this,e=$("<div />").attr("id","widget_"+t.settings.id).addClass("cakebox-widget").appendTo(t.obj),a=$("<h3 />").addClass("handle").appendTo(e);""!==t.settings.chartTitle&&a.text(t.settings.chartTitle);var i=$("<div />").addClass("panel").addClass("panel-flat").appendTo(e),s=$("<div />").addClass("heading-elements").appendTo(a),n=$("<ul />").addClass("icons-list").appendTo(s);if(Object.keys(t.supported_chart_types).length>1){var o=$("<li />").appendTo(n),d=$("<select />").attr("id",t.settings.id+"_charttype").appendTo(o);$.each(t.supported_chart_types,function(e,a){var i=$("<option />").attr("value",e).text(a).appendTo(d);e===t.settings.chartType&&i.attr("selected","selected")}),d.change(function(){t.settings.chartType=$(this).val(),t.validChartType(),t.setChartOption()})}if(null!==t.settings.btn_reload&&($("<li />").html('<a id="'+t.settings.btn_reload.id+'" data-action="reload" title="'+t.settings.btn_reload.title+'"></a>').appendTo(n),$("#"+t.settings.btn_reload.id).click(function(e){e.preventDefault(),t.demo===!1&&t.loadData()})),null!==t.settings.btn_remove&&($("<li />").html('<a id="'+t.settings.btn_remove.id+'" data-action="close" title="'+t.settings.btn_remove.title+'" rel="'+t.settings.id+'"></a>').appendTo(n),$("#"+t.settings.btn_remove.id).click(function(e){e.preventDefault(),null!==t.settings.btn_remove.confirm&&""!==t.settings.btn_remove.confirm?confirm(t.settings.btn_remove.confirm)&&t.removeMe():t.removeMe()})),null!==t.settings.filters&&t.settings.filters.enabled===!0){var r=$("<div />").addClass("panel-heading").appendTo(i),l=$("<div />").addClass("row").appendTo(r),c=$("<div />").addClass("col-md-12").appendTo(l),p=$("<div />").addClass("row").addClass("btn_top").appendTo(c),h=$("<div />").addClass("col-md-4").appendTo(p),g=$("<select />").attr("id",t.settings.filters.branch.id).addClass("form-control").appendTo(h);$("<option />").attr("value","").text("ALL AREA").appendTo(g),g.change(function(){t.demo===!1&&t.loadData()}),g.attr("disabled","disabled");var m=$("<div />").addClass("col-md-4").appendTo(p),_=$("<select />").attr("id",t.settings.filters.compare.id).addClass("form-control").appendTo(m);$("<option />").attr("value","").text("COMPARE").appendTo(_),$("<option />").attr("value","average").text("AVERAGE").appendTo(_),_.change(function(){t.demo===!1&&t.loadData()}),_.attr("disabled","disabled");var f=$("<div />").addClass("col-md-4").appendTo(p),u=$("<select />").attr("id",t.settings.filters.date.id).addClass("form-control").appendTo(f);$.each(t.date_filters,function(t,e){$("<option />").attr("value",t).text(e).appendTo(u)}),u.change(function(){t.demo===!1&&t.loadData()}),t.loadBranches(),t.loadFilters()}var v=$("<div />").addClass("panel-body").appendTo(i),y=$("<div />").addClass("row").appendTo(v),x=$("<div />").attr("id","demography1").appendTo(y);null!==t.settings.icon_man&&null!==t.settings.icon_woman?x.addClass("col-md-8"):x.addClass("col-md-12");var b=$("<div />").addClass("chart-container").appendTo(x);$("<div />").addClass("chart-loading").attr("id",t.settings.id+"_loading").html('<div><i class="icon-spinner2 spinner"></i> '+t.settings.loading+"</div>").appendTo(b);var C=$("<div />").addClass("chart").attr("id",t.settings.id).appendTo(b);if(t.settings.fixedHeight===!0&&C.addClass("has-fixed-height"),null!==t.settings.icon_man&&null!==t.settings.icon_woman){var T=$("<div />").attr("id","demography2").addClass("col-md-4").appendTo(y),D=$("<div />").addClass("row").addClass("demography-icon").appendTo(T);$("<div />").addClass("col-md-6").html("<div>"+t.settings.icon_man.label+'</div><div id="'+t.settings.icon_man.id+'" class="'+t.settings.icon_man["class"]+'"></div><div id="'+t.settings.male_pc.id+'"></div>').appendTo(D),$("<div />").addClass("col-md-6").html("<div>"+t.settings.icon_woman.label+'</div><div id="'+t.settings.icon_woman.id+'" class="'+t.settings.icon_woman["class"]+'"></div><div id="'+t.settings.female_pc.id+'"></div>').appendTo(D),$("#"+t.settings.icon_man.id).click(function(e){null!==t.settings.icon_woman&&$("#"+t.settings.icon_woman.id).length>0&&$("#"+t.settings.icon_woman.id).removeClass("active"),"man"===t.current_type?($(this).removeClass("active"),t.chartChanged()):($(this).addClass("active"),t.chartChanged("man"))}),$("#"+t.settings.icon_woman.id).click(function(e){null!==t.settings.icon_man&&$("#"+t.settings.icon_man.id).length>0&&$("#"+t.settings.icon_man.id).removeClass("active"),"woman"===t.current_type?($(this).removeClass("active"),t.chartChanged()):($(this).addClass("active"),t.chartChanged("woman"))})}},cakeboxWidgetDemography.prototype.setChartOption=function(t){var e=this;"undefined"==typeof t&&(t=!1),e.chart_options=(!e.demo,cakeboxChart.getChartOptions(e.settings.chartType,e.settings.grid,e.settings.yAxis,e.settings.xAxis)),e.chart_options_man=(!e.demo,cakeboxChart.getChartOptions(e.settings.chartType,e.settings.grid,e.settings.yAxis,e.settings.xAxis)),e.chart_options_woman=(!e.demo,cakeboxChart.getChartOptions(e.settings.chartType,e.settings.grid,e.settings.yAxis,e.settings.xAxis)),e.demo?e.updateChartData():t===!0?e.loadData(!0):e.updateChartData()},cakeboxWidgetDemography.prototype.loadData=function(t){var e=this,a=e.data_api_url,i=!0,s=this.getQueryParameter(t);i&&($("#"+this.settings.id+"_loading").show("fast"),$.post(a,s,function(t){e.demography_data=t.data,e.updateChartData()}))},cakeboxWidgetDemography.prototype.setDataSeriesFormat=function(){var t=this,e=[],a=[],i=!1;if(t.demo?i=cakeboxChart.getDemoXAxis(t.settings.chartType):"undefined"!=typeof t.demography_data.xAxis&&t.demography_data.xAxis.length>0&&(i=cakeboxChart.getXAxis(t.settings.chartType,{data:t.demography_data.xAxis})),i!==!1&&"undefined"!=typeof t.chart_options.xAxis&&(t.chart_options.xAxis=[],t.chart_options.xAxis=i),!t.demo,0)e=cakeboxChart.getDemoSerie(t.settings.chartType);else{var s=t.demography_data.series;$.each(s,function(i,s){var n,o;if("undefined"!=typeof s[0]){n=0===i?t.settings.chart.male.color:t.settings.chart.male.compare.color,o=0===i?t.settings.chart.male.label.color:t.settings.chart.male.compare.label.color;var d=s[0],r=cakeboxChart.getSerieFormat(t.settings.chartType,d.data,{name:d.name,color:n,txt_color:o});e.push(r),a.push(d.name)}else console.log("male data not existed - "+i);if("undefined"!=typeof s[1]){n=0===i?t.settings.chart.female.color:t.settings.chart.female.compare.color,o=0===i?t.settings.chart.female.label.color:t.settings.chart.female.compare.label.color;var l=s[1],c=cakeboxChart.getSerieFormat(t.settings.chartType,l.data,{name:l.name,color:n,txt_color:o});e.push(c),a.push(l.name)}else console.log("female data not existed - "+i)}),"undefined"!=typeof t.chart_options.legend&&"undefined"!=typeof t.chart_options.legend.data&&(t.chart_options.legend.data=[],t.chart_options.legend.data=t.clone(a),t.chart_options_man.legend.data=[],t.chart_options_man.legend.data.push(t.clone(a[0])),"undefined"!=typeof a[2]&&t.chart_options_man.legend.data.push(t.clone(a[2])),t.chart_options_woman.legend.data=[],t.chart_options_woman.legend.data.push(t.clone(a[1])),"undefined"!=typeof a[2]&&t.chart_options_woman.legend.data.push(t.clone(a[3])))}t.chart_options.series=e,t.chart_options_man.series=[],t.chart_options_man.series.push(t.clone(e[0])),t.chart_options_woman.series=[],t.chart_options_woman.series.push(t.clone(e[1]))},cakeboxWidgetDemography.prototype.displayData=function(){switch(this.current_type){case"man":this.chart_o.setOption(this.chart_options_man);break;case"woman":this.chart_o.setOption(this.chart_options_woman);break;default:this.chart_o.setOption(this.chart_options)}this.getMFPercentage(),$("#"+this.settings.id+"_loading").hide("fast")},cakeboxWidgetDemography.prototype.setThisDate=function(t){var e="undefined"==typeof t?this.getThisDate():this.getThisDate(t);this.getDateEnd(e);"undefined"==typeof t&&this.settings.filters.enabled===!0&&$("#"+this.settings.filters.date.id).length>0&&$("#"+this.settings.filters.date.id).val(this.getThisDate(null,"m/d/Y"))},cakeboxWidgetDemography.prototype.getMFPercentage=function(){for(var t=0,e=this.chart_options.series[0].data,a=0;a<e.length;a++)t+=e[a];for(var i=0,s=this.chart_options.series[1].data,n=0;n<s.length;n++)i+=s[n];var o=t+i;if(null!==this.settings.male_pc&&$("#"+this.settings.male_pc.id).length>0){var d=o>0?(100*parseFloat(t/o)).toFixed(2):0;$("#"+this.settings.male_pc.id).text(d+"%")}if(null!==this.settings.female_pc&&$("#"+this.settings.female_pc.id).length>0){var r=o>0?(100*parseFloat(i/o)).toFixed(2):0;$("#"+this.settings.female_pc.id).text(r+"%")}},cakeboxWidgetDemography.prototype.chartChanged=function(t){this.current_type=t,this.chart_o.clear(),this.displayData()},cakeboxWidgetDemography.prototype.getThisDate=function(t,e){t="undefined"==typeof t||null===t?new Date:new Date(t),"undefined"==typeof e&&(e="Y-m-d");var a=t.getDate(),i=t.getMonth()+1,s=t.getFullYear();10>a&&(a="0"+a),10>i&&(i="0"+i);var n=e;return n=n.replace("Y",s),n=n.replace("m",i),n=n.replace("d",a)},cakeboxWidgetDemography.prototype.getDateEnd=function(t,e){"undefined"==typeof e&&(e="Y-m-d");var a=new Date(t);a.setDate(a.getDate()+1);var i=a.getDate(),s=a.getMonth()+1,n=a.getFullYear();10>i&&(i="0"+i),10>s&&(s="0"+s);var o=e;return o=o.replace("Y",n),o=o.replace("m",s),o=o.replace("d",i)},function(t){"use strict";t.fn.cakeboxDemography=function(e){if(this.length>1)return this.each(function(){t(this).cakeboxDemography(e)}),this;var a={id:"demography",chartType:"bar",chart:{male:{name:"Male",color:"#0072bc",label:{color:"#000"},compare:{color:"",label:{color:""}}},female:{name:"Female",color:"#f49ac1",label:{color:"#000"},compare:{color:"",label:{color:""}}}},chartTitle:"DEMOGRAPHY",fixedHeight:!0,xAxis:{name:"Age",data:["0-20","21-30","31-40","41-50","51-60","61-100"]},yAxis:{format:"{value} ppl",line:{color:"#666"}},grid:{x:65,x2:30,y:85,y2:25},icon_man:{id:"icon-man","class":"icon-man",label:"MALE"},icon_woman:{id:"icon-woman","class":"icon-woman",label:"FEMALE"},male_pc:{id:"male_percentage"},female_pc:{id:"female_percentage"},btn_reload:{id:"demography_reload",title:"Reload data"},btn_remove:{id:"demography_remove",title:"Remove this chart",confirm:"Please confirm to remove this chart"},filters:{enabled:!0,branch:{id:"demography_branch",value:""},compare:{id:"demography_compare",value:""},date:{id:"demography_date",value:""}},loading:"Loading"},i=t.extend(!0,a,e),s=new cakeboxWidgetDemography(this,i);return this.refreshChart=function(){s.refreshChart()},this.removeChart=function(){s.removeChart()},this}}(jQuery);