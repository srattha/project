var cakeboxWidgetZone=function(e,t){return cakeboxWidget.apply(this,arguments),this.obj=e,this.chart_dwelltime_o=null,this.default_chart_type="pie",this.default_chart_dwelltime_type="line",this.supported_chart_types={pie:"Pie Chart"},this.supported_chart_types2={bar:"Bar Chart",line:"Line Chart"},this.zone_data=[],this.zone_dwelltime_data=[],this.zones=[{name:"Zone 1",value:120,color:"#b6a2de"},{name:"Zone 2",value:198,color:"#2ec7c9"},{name:"Zone 3",value:103,color:"#c69c6d"}],this.zone_dwelltime=[{name:"New",data:[5,13,7,12,14,10,2],color:"#b6a2de"},{name:"Repeat",data:[9,7,19,5,11,5,12],color:"#2ec7c9"},{name:"Total",data:[4,11,12,8,13,9,16],color:"#c69c6d"}],this.data_api_url="/api/widget/zone",this.data_dwelltime_api_url="/api/widget/zone/dwelltime",this.branch_api_url="/api/zone2?type=3",this.date_filter_url="/api/datefilters",this.zone_analytics_options={},this.zone_dwelltime_options={},this.settings=$.extend(!0,this.defaults,t),this.init(),this};cakeboxWidgetZone.prototype=Object.create(cakeboxWidget.prototype),cakeboxWidgetZone.prototype.createUI=function(){var e=this,t=$("<div />").attr("id","widget_"+e.settings.id).addClass("cakebox-widget").appendTo(this.obj),a=$("<h3 />").addClass("handle").appendTo(t);""!==e.settings.chartTitle&&a.text(e.settings.chartTitle).appendTo(a);var i=$("<div />").addClass("panel").addClass("panel-flat").appendTo(t),o=$("<div />").addClass("heading-elements").appendTo(a),n=$("<ul />").addClass("icons-list").appendTo(o);if(Object.keys(e.supported_chart_types2).length>0){var s=$("<li />").appendTo(n),l=$("<select />").attr("id",e.settings.id+"_charttype").appendTo(s);$.each(e.supported_chart_types2,function(t,a){var i=$("<option />").attr("value",t).text(a).appendTo(l);t===e.settings.chart.dwelltime.chartType&&i.attr("selected","selected")}),l.change(function(){e.settings.chart.dwelltime.chartType=$(this).val(),e.validChartType(),e.setChartOption(!1)})}if(null!==e.settings.btn_reload&&($("<li />").html('<a id="'+e.settings.btn_reload.id+'" data-action="reload" title="'+e.settings.btn_reload.title+'"></a>').appendTo(n),$("#"+e.settings.btn_reload.id).click(function(t){t.preventDefault(),e.demo===!1&&e.loadData()})),null!==e.settings.btn_remove&&($("<li />").html('<a id="'+e.settings.btn_remove.id+'" data-action="close" title="'+e.settings.btn_remove.title+'" rel="'+e.settings.id+'"></a>').appendTo(n),$("#"+e.settings.btn_remove.id).click(function(t){t.preventDefault(),null!==e.settings.btn_remove.confirm&&""!==e.settings.btn_remove.confirm?confirm(e.settings.btn_remove.confirm)&&e.removeMe():e.removeMe()})),null!==e.settings.filters&&e.settings.filters.enabled===!0){var d=$("<div />").addClass("panel-heading").appendTo(i),r=$("<div />").addClass("row").appendTo(d),c=$("<div />").addClass("col-md-12").appendTo(r),p=$("<div />").addClass("row").addClass("btn_top").appendTo(c),h=$("<div />").addClass("col-md-4").appendTo(p),m=$("<select />").attr("id",e.settings.filters.branch.id).addClass("form-control").appendTo(h);$("<option />").attr("value","").text("-CHOOSE AREA-").appendTo(m),m.change(function(){e.demo===!1&&e.loadData()});var _=$("<div />").addClass("col-md-4").appendTo(p),g=$("<select />").attr("id",e.settings.filters.compare.id).addClass("form-control").appendTo(_);$("<option />").attr("value","").text("COMPARE").appendTo(g),g.change(function(){e.demo===!1&&e.loadData()});var u=$("<div />").addClass("col-md-4").appendTo(p),f=$("<select />").attr("id",e.settings.filters.date.id).addClass("form-control").appendTo(u);$.each(e.date_filters,function(e,t){$("<option />").attr("value",e).text(t).appendTo(f)}),f.change(function(){e.demo===!1&&e.loadData()}),e.loadFilters(),e.loadBranches()}var w=$("<div />").addClass("panel-body").appendTo(i),x=$("<div />").addClass("row").addClass("chart-container").appendTo(w),v=$("<div />").attr("id","zone_chart1").appendTo(x);null!==e.settings.chart.dwelltime&&e.settings.chart.dwelltime.enabled===!0?v.addClass("col-md-6"):v.addClass("col-md-12"),$("<div />").addClass("chart-loading").attr("id",e.settings.id+"_loading").html('<div><i class="icon-spinner2 spinner"></i> '+e.settings.loading+"</div>").appendTo(v);var y=$("<div />").addClass("chart").attr("id",e.settings.id).appendTo(v);if(e.settings.fixedHeight===!0&&y.addClass("has-fixed-height"),null!==e.settings.chart.dwelltime&&e.settings.chart.dwelltime.enabled===!0){var b=$("<div />").attr("id","zone_chart2").addClass("col-md-6").appendTo(x);$("<div />").addClass("chart-loading").attr("id",e.settings.chart.dwelltime.id+"_loading").html('<div><i class="icon-spinner2 spinner"></i> '+e.settings.loading+"</div>").appendTo(b);var C=$("<div />").addClass("chart").attr("id",e.settings.chart.dwelltime.id).appendTo(b);e.settings.fixedHeight===!0&&C.addClass("has-fixed-height")}},cakeboxWidgetZone.prototype.validChartType=function(){var e=this.settings.chartType;"undefined"==typeof this.supported_chart_types[e]&&(this.settings.chartType=this.default_chart_type),e=this.settings.chart.dwelltime.chartType,"undefined"==typeof this.supported_chart_types2[e]&&(this.settings.chart.dwelltime.chartType=this.default_chart_dwelltime_type)},cakeboxWidgetZone.prototype.createChart=function(e,t){var a=this;a.chart_o=e.init(document.getElementById(a.settings.id),t),a.chart_dwelltime_o=e.init(document.getElementById(a.settings.chart.dwelltime.id),t),a.chart_o.connect(a.chart_dwelltime_o),a.chart_dwelltime_o.connect(a.chart_o),a.setChartOption(!0),window.addEventListener("resize",function(){setTimeout(function(){a.chart_o.resize(),a.chart_dwelltime_o.resize()},200)},!0),null!==a.settings.btn_reload&&$("#"+a.settings.btn_reload.id).length>0&&$("#"+a.settings.btn_reload.id).click(function(e){e.preventDefault(),console.log("zone reloaded"),a.demo===!1&&a.loadData()}),null!==a.settings.btn_remove&&$("#"+a.settings.btn_remove.id).length>0&&$("#"+a.settings.btn_remove.id).click(function(e){e.preventDefault(),null!==a.settings.btn_remove.confirm&&""!==a.settings.btn_remove.confirm?confirm(a.settings.btn_remove.confirm)&&a.removeMe():a.removeMe()})},cakeboxWidgetZone.prototype.setChartOption=function(e){var t=this;"undefined"==typeof e&&(e=!1),t.chart_o.clear(),t.chart_dwelltime_o.clear(),t.zone_analytics_options=t.demo?cakeboxChart.getDemoOption(t.settings.chartType):cakeboxChart.getChartOptions(t.settings.chartType,t.settings.grid,t.settings.yAxis),t.zone_dwelltime_options=t.demo?cakeboxChart.getDemoOption(t.settings.chart.dwelltime.chartType):cakeboxChart.getChartOptions(t.settings.chart.dwelltime.chartType,t.settings.grid,t.settings.chart.dwelltime.yAxis),t.demo?(t.updateChartData(),t.updateChartDataDwelltime()):e===!0?t.loadData(!0):(t.updateChartData(),t.updateChartDataDwelltime())},cakeboxWidgetZone.prototype.loadData=function(e){var t=this,a=t.data_api_url,i=!0,o=this.getQueryParameter(e);("undefined"==typeof o.area||"undefined"!=typeof o.area&&(""===o.area||isNaN(o.area)))&&(i=!1),i&&($("#"+t.settings.id+"_loading").show("fast"),$("#"+t.settings.chart.dwelltime.id+"_loading").show("fast"),$.post(a,o,function(e){t.zone_data=e.data,t.updateChartData()},"json"),a=t.data_dwelltime_api_url,$.post(a,o,function(e){t.zone_dwelltime_data=e.data,t.updateChartDataDwelltime()},"json"))},cakeboxWidgetZone.prototype.updateChartData=function(){var e=this;e.chart_o.clear();var t;if(t=e.demo?cakeboxChart.getDemoXAxis(e.settings.chart.dwelltime.chartType):cakeboxChart.getXAxis(e.settings.chartType,e.zone_data.xAxis),t!==!1&&"undefined"!=typeof e.zone_analytics_options.xAxis&&(e.zone_analytics_options.xAxis=t),e.demo){e.zone_analytics_options.series=[];var a=[];$.each(e.zones,function(t,i){var o=e.zones[t];a.push({value:o.value,name:o.name,color:o.color})}),e.zone_analytics_options.series=cakeboxChart.getSerieFormat(e.settings.chartType,a)}else e.setDataSeriesFormat();e.displayData()},cakeboxWidgetZone.prototype.updateChartDataDwelltime=function(){var e=this;e.chart_dwelltime_o.clear();var t;if(e.demo?t=cakeboxChart.getDemoXAxis(e.settings.chart.dwelltime.chartType):"undefined"!=typeof e.zone_dwelltime_data.xAxis&&e.zone_dwelltime_data.xAxis.length>0&&(t=cakeboxChart.getXAxis(e.settings.chart.dwelltime.chartType,{data:e.zone_dwelltime_data.xAxis})),t!==!1&&"undefined"!=typeof e.zone_dwelltime_options.xAxis&&(e.zone_dwelltime_options.xAxis=t),e.demo){e.zone_dwelltime_options.series=[];var a=[];$.each(e.zone_dwelltime,function(t,i){var o=e.zone_dwelltime[t],n=o.data,s={value:o.value,name:o.name,color:o.color};a.push(cakeboxChart.getSerieFormat(e.settings.chart.dwelltime.chartType,n,s))}),e.zone_dwelltime_options.series=a}else e.setDataSeriesFormatDwelltime();e.displayDataDwellTime()},cakeboxWidgetZone.prototype.setDataSeriesFormat=function(){var e=this,t=[],a=[],i=!1;if(e.demo?i=cakeboxChart.getDemoXAxis(e.settings.chartType):"undefined"!=typeof e.zone_data.xAxis&&e.zone_data.xAxis.length>0&&(i=cakeboxChart.getXAxis(e.settings.chartType,{data:e.zone_data.xAxis})),i!==!1&&"undefined"!=typeof e.zone_analytics_options.xAxis&&(e.zone_analytics_options.xAxis=[],e.zone_analytics_options.xAxis=i),e.demo)t=cakeboxChart.getDemoSerie(e.settings.chartType);else{var o=e.zone_data.series,n=[];$.each(o,function(t,i){$.each(i,function(i,o){var s=0===t?e.settings.chart.zone.color:e.settings.chart.zone.compare.color,l=0===t?e.settings.chart.zone.label.color:e.settings.chart.zone.compare.label.color,d={name:o.name,color:s,txt_color:l,value:o.data};n.push(d),a.push(o.name)})}),t=cakeboxChart.getSerieFormat(e.settings.chartType,n,{}),"undefined"!=typeof e.zone_analytics_options.legend&&"undefined"!=typeof e.zone_analytics_options.legend.data&&(e.zone_analytics_options.legend.data=[],e.zone_analytics_options.legend.data=e.clone(a))}e.zone_analytics_options.series=t},cakeboxWidgetZone.prototype.setDataSeriesFormatDwelltime=function(){var e=this,t=[],a=[],i=!1;if(e.demo?i=cakeboxChart.getDemoXAxis(e.settings.chart.dwelltime.chartType):"undefined"!=typeof e.zone_dwelltime_data.xAxis&&e.zone_dwelltime_data.xAxis.length>0&&(i=cakeboxChart.getXAxis(e.settings.chart.dwelltime.chartType,{data:e.zone_dwelltime_data.xAxis})),i!==!1&&"undefined"!=typeof e.zone_dwelltime_options.xAxis&&(e.zone_dwelltime_options.xAxis=[],e.zone_dwelltime_options.xAxis=i),e.demo)t=cakeboxChart.getDemoSerie(e.settings.chart.dwelltime.chartType);else{var o=e.zone_dwelltime_data.series;$.each(o,function(i,o){var n,s,l,d;if("undefined"!=typeof o.data["new"]&&o.data["new"].length>0){n=0===i?e.settings.chart.dwelltime["new"].color:e.settings.chart.dwelltime["new"].compare.color,s=0===i?e.settings.chart.dwelltime["new"].label.color:e.settings.chart.dwelltime["new"].compare.label.color,l=o.name+" - New",d={name:l,color:n,txt_color:s};var r=cakeboxChart.getSerieFormat(e.settings.chart.dwelltime.chartType,o.data["new"],d);t.push(r),a.push(l)}if("undefined"!=typeof o.data.repeat&&o.data.repeat.length>0){n=0===i?e.settings.chart.dwelltime.repeat.color:e.settings.chart.dwelltime.repeat.compare.color,s=0===i?e.settings.chart.dwelltime.repeat.label.color:e.settings.chart.dwelltime.repeat.compare.label.color,l=o.name+" - Repeat",d={name:l,color:n,txt_color:s};var r=cakeboxChart.getSerieFormat(e.settings.chart.dwelltime.chartType,o.data.repeat,d);t.push(r),a.push(l)}if("undefined"!=typeof o.data.total&&o.data.total.length>0){n=0===i?e.settings.chart.dwelltime.total.color:e.settings.chart.dwelltime.total.compare.color,s=0===i?e.settings.chart.dwelltime.total.label.color:e.settings.chart.dwelltime.total.compare.label.color,l=o.name+" - Total",d={name:l,color:n,txt_color:s};var r=cakeboxChart.getSerieFormat(e.settings.chart.dwelltime.chartType,o.data.total,d);t.push(r),a.push(l)}}),"undefined"!=typeof e.zone_dwelltime_options.legend&&"undefined"!=typeof e.zone_dwelltime_options.legend.data&&(e.zone_dwelltime_options.legend.data=[],e.zone_dwelltime_options.legend.data=e.clone(a))}e.zone_dwelltime_options.series=t},cakeboxWidgetZone.prototype.displayData=function(){this.chart_o.setOption(this.zone_analytics_options),$("#"+this.settings.id+"_loading").hide("fast")},cakeboxWidgetZone.prototype.displayDataDwellTime=function(){this.chart_dwelltime_o.setOption(this.zone_dwelltime_options),$("#"+this.settings.chart.dwelltime.id+"_loading").hide("fast")},cakeboxWidgetZone.prototype.refreshChart=function(){this.chart_o.resize(),null!==this.chart_dwelltime_o&&this.chart_dwelltime_o.resize(),this.adjustWidget()},function(e){"use strict";e.fn.cakeboxZone=function(t){if(this.length>1)return this.each(function(){e(this).cakeboxZone(t)}),this;var a={id:"zone_analytics",chartType:"pie",chart:{zone:{color:"",label:{color:""},compare:{color:"",label:{color:""}}},dwelltime:{enabled:!0,id:"zone_dwelltime",chartType:"line","new":{name:"New",color:"",label:{color:""},compare:{name:"New Compare",color:"",label:{color:""}}},repeat:{name:"Repeat",color:"",label:{color:""},compare:{name:"Repeat Compare",color:"",label:{color:""}}},total:{name:"Total",color:"",label:{color:""},compare:{name:"Total Compare",color:"",label:{color:""}}},xAxis:{name:""},yAxis:{format:"{value} minutes",line:{color:"#666"}}}},chartTitle:"ZONE ANALYTICS",fixedHeight:!0,xAxis:{name:""},yAxis:{format:"{value} minutes",line:{color:"#666"}},grid:{x:100,x2:20,y:35,y2:25},btn_reload:{id:"zone_reload",title:"Reload data"},btn_remove:{id:"zone_remove",title:"Remove this chart",confirm:"Please confirm to remove this chart"},filters:{enabled:!0,branch:{id:"zone_branch",value:5},compare:{id:"zone_compare",value:""},date:{id:"zone_date",value:"this_month"}},loading:"Loading"},i=e.extend(!0,a,t),o=new cakeboxWidgetZone(this,i);return this.refreshChart=function(){o.refreshChart()},this.removeChart=function(){o.removeChart()},this}}(jQuery);